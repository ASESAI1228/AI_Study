# RAG（検索拡張生成）実装演習

## 目的

この演習では、RAG（検索拡張生成）システムを実装し、法務文書の検索と質問応答を効率化する方法を学びます。文書のインデックス作成、ベクトル検索、生成AIとの連携など、実践的なスキルを習得することを目的としています。

## 準備

1. 必要なライブラリをインストールしてください
   ```
   pip install openai numpy scikit-learn pandas python-dotenv faiss-cpu
   ```

2. `.env`ファイルにAPIキーを設定してください
   ```
   OPENAI_API_KEY=your_openai_api_key
   ```

3. サンプルの法律文書を準備してください（契約書、法律条文、社内規定など）

## 演習1：文書の前処理とベクトル化

### 課題1-1：文書の前処理

`code-examples/rag_example.py`を参照し、以下の課題に取り組んでください：

1. サンプルの法律文書を読み込み、適切なチャンク（セグメント）に分割するプログラムを実装してください
   - 段落ごと、条項ごと、または固定文字数ごとなど、適切な分割方法を選択してください
   - 分割したチャンクに文書ID、タイトル、セクション情報などのメタデータを付与してください

2. 分割したチャンクをクリーニングするプログラムを実装してください
   - 不要な空白や特殊文字の削除
   - フォーマットの統一
   - 重複の除去

### 課題1-2：文書のベクトル化

1. OpenAI APIを使用して、各チャンクの埋め込みベクトルを生成するプログラムを実装してください

2. 生成した埋め込みベクトルとメタデータを保存する仕組みを実装してください
   - CSVファイル、JSONファイル、またはデータベースなど適切な保存方法を選択してください

3. ベクトル化のバッチ処理を実装し、大量の文書を効率的に処理できるようにしてください

## 演習2：ベクトル検索の実装

### 課題2-1：基本的なベクトル検索

1. コサイン類似度を使用して、クエリと最も関連性の高い文書チャンクを検索するプログラムを実装してください

2. 検索結果をスコア順にランキングし、上位N件を返す機能を実装してください

3. 検索結果に文書のメタデータ（タイトル、セクション情報など）を含めてください

### 課題2-2：高度な検索機能

1. FAISS（Facebook AI Similarity Search）を使用して、より効率的なベクトル検索を実装してください

2. 以下の検索機能を実装してください：
   - メタデータによるフィルタリング（特定の文書タイプや日付範囲など）
   - 複合クエリ（複数のクエリベクトルの組み合わせ）
   - 類似度スコアの正規化

3. 検索パフォーマンスを評価し、最適化する方法を検討してください

## 演習3：生成AIとの連携

### 課題3-1：基本的なRAGシステムの実装

1. ユーザーの質問を受け取り、以下のステップで回答を生成するRAGシステムを実装してください：
   - 質問をベクトル化
   - 関連する文書チャンクを検索
   - 検索結果を元に、生成AIを使用して回答を生成

2. システムプロンプトを工夫して、法務専門家らしい回答を生成できるようにしてください

3. 回答に使用した情報源（文書チャンク）を引用として表示する機能を実装してください

### 課題3-2：RAGシステムの改良

1. 以下の機能を追加して、RAGシステムを改良してください：
   - 質問の明確化（質問が曖昧な場合、ユーザーに確認を求める）
   - 複数回答の生成（異なる視点からの回答）
   - 確信度スコアの表示（回答の信頼性を示す指標）

2. 回答の品質を向上させるための工夫を実装してください：
   - 検索結果の前処理（重複の除去、関連性の低い情報のフィルタリングなど）
   - プロンプトエンジニアリングの適用
   - 回答の構造化（箇条書き、見出しなどの活用）

## 演習4：評価と最適化

### 課題4-1：システムの評価

1. RAGシステムの評価用のテストケース（質問と期待される回答のペア）を作成してください

2. 以下の指標を使用して、システムの性能を評価してください：
   - 回答の正確性
   - 回答の完全性
   - 回答の関連性
   - 応答時間

3. 評価結果を分析し、システムの強みと弱みを特定してください

### 課題4-2：システムの最適化

1. 評価結果に基づいて、RAGシステムを最適化してください：
   - チャンクサイズの調整
   - 検索アルゴリズムの改良
   - プロンプトの最適化
   - モデルパラメータの調整

2. 最適化前後の性能を比較し、改善効果を測定してください

3. システムの拡張性と保守性を向上させるための設計改善を行ってください

## 提出課題

以上の演習を通じて学んだことを活かして、以下の課題に取り組んでください：

1. 法務文書を対象としたRAGシステムを設計・実装してください
   - 少なくとも3種類の法務文書（契約書、法律条文、社内規定など）を対象とすること
   - 効率的な検索と高品質な回答生成を実現すること
   - ユーザーフレンドリーなインターフェースを提供すること

2. 以下の機能を含めてください：
   - 文書のアップロードと自動インデックス作成
   - 自然言語による質問入力
   - 関連文書の検索と表示
   - 質問に対する回答の生成
   - 情報源の引用と説明

3. 以下の内容を含むレポートを作成してください（800〜1,200字程度）：
   - システムの設計と実装の概要
   - 技術的な工夫点と課題解決方法
   - 評価結果と最適化の効果
   - 実務での活用シナリオと期待される効果
   - 今後の改善点

4. システムのデモンストレーション動画（3分程度）を作成してください

提出方法：研修用ポータルサイトの課題提出ページからソースコード、レポート、デモ動画をアップロードしてください。 