# データベース連携演習

## 目的

この演習では、Pythonを使用してデータベースに接続し、法務業務に関連するデータの保存、検索、更新を行う方法を学びます。PostgreSQLとSupabaseを使用した実践的なデータベース操作を習得することを目的としています。

## 準備

1. PostgreSQLをインストールするか、Supabaseアカウントを作成してください
   - PostgreSQLのインストール: https://www.postgresql.org/download/
   - Supabaseアカウント作成: https://supabase.com/

2. 必要なライブラリをインストールしてください
   ```
   pip install psycopg2-binary supabase pandas python-dotenv
   ```

3. `.env`ファイルを作成し、接続情報を設定してください
   ```
   # PostgreSQL接続情報
   PG_HOST=localhost
   PG_DATABASE=legal_db
   PG_USER=postgres
   PG_PASSWORD=your_password

   # Supabase接続情報
   SUPABASE_URL=your_supabase_url
   SUPABASE_KEY=your_supabase_key
   ```

## 演習1：データベース設計と作成

### 課題1-1：テーブル設計

`code-examples/database_operations.py`を参照し、以下の課題に取り組んでください：

1. 法務業務に必要なデータベーススキーマを設計してください。以下のエンティティを含めてください：
   - 契約書（contracts）
   - 契約書タイプ（contract_types）
   - 取引先（counterparties）
   - ユーザー（users）
   - レビュー（reviews）

2. 各テーブルの列（フィールド）を定義し、適切なデータ型を選択してください

3. テーブル間のリレーションシップを定義してください（外部キー制約など）

### 課題1-2：テーブル作成とサンプルデータ挿入

1. 設計したスキーマに基づいてテーブルを作成するSQLスクリプトを作成してください

2. 各テーブルにサンプルデータを挿入するSQLスクリプトを作成してください

3. Pythonを使用して、作成したSQLスクリプトを実行するプログラムを実装してください

## 演習2：基本的なデータベース操作

### 課題2-1：データの検索と表示

1. 以下の検索条件に基づいて契約書を検索するプログラムを作成してください：
   - 契約書タイプ別の検索
   - 有効期限が特定の日付範囲内の契約書の検索
   - 特定の取引先との契約書の検索
   - 複数の条件を組み合わせた検索

2. 検索結果を見やすく整形して表示してください

### 課題2-2：データの更新と削除

1. 契約書の状態（ステータス）を更新するプログラムを作成してください

2. 契約書の有効期限を延長するプログラムを作成してください

3. 不要になった契約書を削除（または論理削除）するプログラムを作成してください

4. トランザクションを使用して、複数のテーブルにまたがる更新を安全に行うプログラムを作成してください

## 演習3：高度なデータベース操作

### 課題3-1：複雑なクエリとJOIN

1. 契約書とそのレビュー情報を結合して表示するプログラムを作成してください

2. 特定のユーザーがレビューした契約書の一覧を表示するプログラムを作成してください

3. 契約書タイプ別の統計情報（件数、平均契約期間など）を計算するプログラムを作成してください

4. 期限切れが近い契約書とその担当者を特定するプログラムを作成してください

### 課題3-2：Pandasとの連携

1. データベースから取得したデータをPandas DataFrameに読み込み、分析するプログラムを作成してください

2. 以下の分析を行ってください：
   - 契約書タイプ別の集計
   - 月別・年別の契約書数の推移
   - 取引先別の契約書数と金額の分析
   - レビュー状況の分析

3. 分析結果をCSVファイルに出力するプログラムを作成してください

## 演習4：Supabaseを使用した高度な機能

### 課題4-1：認証機能の実装

1. Supabaseの認証機能を使用して、以下の機能を実装してください：
   - ユーザー登録（サインアップ）
   - ログイン（サインイン）
   - パスワードリセット
   - ユーザープロファイルの取得と更新

2. 認証済みユーザーのみがデータにアクセスできるように、アクセス制御を実装してください

### 課題4-2：リアルタイム更新の実装

1. Supabaseのリアルタイム機能を使用して、データの変更をリアルタイムで監視するプログラムを作成してください

2. 新しい契約書が追加されたり、既存の契約書が更新されたりした場合に通知を表示するプログラムを実装してください

3. 複数のユーザーが同時に作業する場合のデータ整合性を確保する方法を実装してください

## 提出課題

以上の演習を通じて学んだことを活かして、以下の課題に取り組んでください：

1. 法務文書管理システムのデータベースを設計・実装してください
   - 適切なテーブル設計とリレーションシップ
   - 効率的なクエリの実装
   - データの整合性と安全性の確保
   - ユーザー認証と権限管理

2. 以下の機能を持つPythonプログラムを実装してください：
   - 契約書の登録、検索、更新、削除
   - レビュープロセスの管理
   - 期限管理と通知機能
   - データの分析と可視化

3. 以下の内容を含むレポートを作成してください（800〜1,200字程度）：
   - データベース設計の考え方と工夫点
   - 実装した機能の概要と技術的な特徴
   - パフォーマンスとセキュリティに関する考慮事項
   - 実務での活用シナリオと期待される効果
   - 今後の改善点

提出方法：研修用ポータルサイトの課題提出ページからSQLスクリプト、Pythonソースコード、レポートをアップロードしてください。 