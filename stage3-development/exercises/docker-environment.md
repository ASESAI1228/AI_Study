# Docker環境構築演習

## 目的

この演習では、Dockerを使用して法務AIアプリケーションの開発・実行環境を構築する方法を学びます。コンテナ化の基本概念から、複数サービスの連携、開発環境と本番環境の分離まで、実践的なスキルを習得することを目的としています。

## 準備

1. Dockerをインストールしてください
   - Windows: Docker Desktop for Windows
   - Mac: Docker Desktop for Mac
   - Linux: Docker Engine

2. Docker Composeをインストールしてください（Docker Desktopには含まれています）

3. 基本的なコマンドラインの操作方法を確認してください

## 演習1：Dockerの基本

### 課題1-1：基本的なDockerコマンド

1. 以下のDockerコマンドを実行し、結果を確認してください：
   - `docker --version`
   - `docker info`
   - `docker images`
   - `docker ps`

2. Dockerハブから公式のPythonイメージをプルしてください：
   ```
   docker pull python:3.9
   ```

3. プルしたイメージを使用して、簡単なPythonスクリプトを実行するコンテナを作成してください：
   ```
   docker run -it --rm python:3.9 python -c "print('Hello, Docker!')"
   ```

### 課題1-2：Dockerfileの作成

1. 以下の内容を含む基本的なDockerfileを作成してください：
   - ベースイメージとしてPython 3.9を使用
   - 必要なライブラリのインストール（pandas, numpy, scikit-learn, openai）
   - 作業ディレクトリの設定
   - 環境変数の設定
   - エントリポイントの設定

2. 作成したDockerfileからイメージをビルドしてください：
   ```
   docker build -t legal-ai-app:v1 .
   ```

3. ビルドしたイメージを使用して、コンテナを実行してください：
   ```
   docker run -it --rm legal-ai-app:v1
   ```

## 演習2：アプリケーションのコンテナ化

### 課題2-1：Pythonアプリケーションのコンテナ化

1. 以前の演習で作成したPythonアプリケーション（APIクライアント、データ処理スクリプトなど）を選択してください

2. 選択したアプリケーションをコンテナ化するためのDockerfileを作成してください：
   - 適切なベースイメージの選択
   - 依存関係のインストール
   - アプリケーションコードのコピー
   - 実行コマンドの設定

3. アプリケーションをコンテナ化し、正常に動作することを確認してください

### 課題2-2：Webアプリケーションのコンテナ化

1. Streamlitで作成したWebアプリケーションをコンテナ化するためのDockerfileを作成してください

2. 以下の点に注意してDockerfileを設計してください：
   - ポートの公開（8501）
   - 環境変数の設定
   - ボリュームのマウント（データの永続化）
   - ヘルスチェックの設定

3. アプリケーションをコンテナ化し、ブラウザからアクセスできることを確認してください：
   ```
   docker run -p 8501:8501 legal-streamlit-app:v1
   ```

## 演習3：複数サービスの連携

### 課題3-1：Docker Composeの基本

1. 以下のサービスを含むDocker Compose構成を作成してください：
   - Webアプリケーション（Streamlit）
   - データベース（PostgreSQL）
   - APIサービス（FastAPI）

2. `docker-compose.yml`ファイルを作成し、各サービスの設定を定義してください：
   - イメージまたはビルド設定
   - ポートマッピング
   - 環境変数
   - ボリューム
   - 依存関係

3. Docker Composeを使用して、すべてのサービスを起動してください：
   ```
   docker-compose up
   ```

### 課題3-2：サービス間の通信

1. Webアプリケーションからデータベースに接続するための設定を行ってください：
   - 接続文字列の設定
   - 認証情報の管理
   - 接続プールの設定

2. WebアプリケーションからAPIサービスにリクエストを送信する機能を実装してください

3. サービス間の通信が正常に機能することを確認してください

## 演習4：開発環境と本番環境の分離

### 課題4-1：環境別の設定

1. 開発環境と本番環境で異なる設定を管理するための方法を実装してください：
   - 環境変数の使用
   - 設定ファイルの分離
   - Docker Composeのオーバーライド機能の活用

2. 以下のファイルを作成してください：
   - `docker-compose.yml`（共通設定）
   - `docker-compose.override.yml`（開発環境用）
   - `docker-compose.prod.yml`（本番環境用）

3. 各環境に適した設定を行ってください：
   - 開発環境：デバッグモード、ボリュームマウント、ホットリロード
   - 本番環境：最適化設定、セキュリティ強化、スケーリング

### 課題4-2：CI/CDパイプラインの設計

1. GitHubなどのバージョン管理システムと連携したCI/CDパイプラインを設計してください：
   - コードの変更検知
   - 自動テスト
   - イメージのビルドと公開
   - デプロイ

2. CI/CDパイプラインの設定ファイル（`.github/workflows/ci-cd.yml`など）を作成してください

3. セキュリティスキャンやコード品質チェックを組み込んでください

## 提出課題

以上の演習を通じて学んだことを活かして、以下の課題に取り組んでください：

1. 法務AIアプリケーションの完全なDockerized環境を構築してください：
   - フロントエンド（Streamlit）
   - バックエンド（FastAPI）
   - データベース（PostgreSQL）
   - AIサービス（OpenAI API連携）

2. 以下の要件を満たす環境を構築してください：
   - 開発環境と本番環境の分離
   - 環境変数による設定管理
   - ボリュームによるデータの永続化
   - ネットワークセキュリティの確保
   - スケーラビリティの考慮

3. 以下の内容を含むレポートを作成してください（800〜1,200字程度）：
   - 環境設計の概要と構成図
   - 各コンポーネントの役割と連携方法
   - 開発環境と本番環境の違いと管理方法
   - セキュリティとパフォーマンスに関する考慮事項
   - 実務での活用シナリオと期待される効果

4. 環境のセットアップと動作確認を示すデモンストレーション動画（3分程度）を作成してください

提出方法：研修用ポータルサイトの課題提出ページからDockerfile、docker-compose.yml、その他の設定ファイル、レポート、デモ動画をアップロードしてください。 