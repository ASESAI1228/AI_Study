import nbformat as nbf
import os

# Create a new notebook for prompt engineering
def create_prompt_engineering_notebook():
    nb = nbf.v4.new_notebook()
    
    cells = [
        nbf.v4.new_markdown_cell("# プロンプト作成演習 - 模範解答\n\nこのノートブックでは、プロンプト作成演習の模範解答と解説を提供します。各演習の回答例を参考にして、効果的なプロンプト設計のスキルを向上させてください。"),
        
        # 演習1
        nbf.v4.new_markdown_cell("## 演習1：基本的なプロンプト設計\n\nこの演習では、3つの法務タスクに対する基本的なプロンプトを作成します。"),
        
        # タスク1
        nbf.v4.new_markdown_cell("### タスク1：契約書の重要条項の抽出と分析"),
        nbf.v4.new_code_cell('''"""
以下の契約書から重要条項を抽出し、分析してください。

[契約書全文をここに貼り付け]

具体的に以下の項目について抽出・分析してください：
1. 契約当事者と役割
2. 契約期間と更新条件
3. 支払い条件と金額
4. 知的財産権の帰属
5. 秘密保持義務の範囲と期間
6. 契約解除条件
7. 紛争解決方法

出力形式：
- 各項目について、該当する条項番号と内容を箇条書きで示してください
- 各項目の法的リスクや注意点を簡潔に説明してください
- 契約書に明記されていない重要事項があれば指摘してください
"""'''),
        
        # タスク2
        nbf.v4.new_markdown_cell("### タスク2：法的質問への回答"),
        nbf.v4.new_code_cell('''"""
以下の法的質問に対して、日本の現行法に基づいて回答してください。

質問：[法的質問をここに記載]
例：「テレワーク中の従業員の労働時間管理について、企業が法的に遵守すべき事項は何ですか？」

回答に含めるべき情報：
1. 関連する法律・条文の名称と概要
2. 主要な法的要件と遵守事項
3. 判例や行政解釈がある場合はその概要
4. 実務上の対応策や推奨事項
5. 最近の法改正や今後予定されている変更点（該当する場合）

出力形式：
- 見出しと段落を使って構造化された回答を提供してください
- 専門用語を使用する場合は、簡潔な説明を付記してください
- 回答の最後に、参考にすべき公的情報源（官公庁サイトなど）を示唆してください
- 法的助言ではなく一般的な情報提供であることを明記してください
"""'''),
        
        # タスク3
        nbf.v4.new_markdown_cell("### タスク3：判例の要約と重要ポイントの抽出"),
        nbf.v4.new_code_cell('''"""
以下の判例を要約し、重要なポイントを抽出してください。

[判例全文をここに貼り付け]

分析すべき項目：
1. 事案の概要（当事者、争点、事実関係）
2. 裁判所の判断（結論と主要な理由付け）
3. 重要な法的論点と裁判所の解釈
4. 先例との関係（踏襲、変更、区別など）
5. 実務への影響と留意点

出力形式：
- 各項目を見出しとして使用し、300-500字程度で簡潔に要約してください
- 判決文から重要な引用部分があれば、引用符で囲んで示してください
- 法律の専門家ではない人にも理解できるよう、平易な言葉で説明してください
- 最後に、この判例から導かれる3-5つの実務上の教訓を箇条書きでまとめてください
"""'''),
        
        # 演習2
        nbf.v4.new_markdown_cell("## 演習2：プロンプトパターンの適用\n\nこの演習では、演習1で作成したプロンプトに以下のパターンを適用して改良します：\n1. ロールプロンプト\n2. ステップバイステップ指示\n3. フューショット学習（例示）"),
        
        # パターン1
        nbf.v4.new_markdown_cell("### パターン1：ロールプロンプト\n\n契約書分析タスクにロールプロンプトパターンを適用します。"),
        nbf.v4.new_code_cell('''"""
あなたは大手法律事務所の契約審査部門で10年以上の経験を持つ弁護士です。特に企業間取引契約の分析と法的リスク評価を専門としています。クライアントから以下の契約書の分析を依頼されました。

[契約書全文をここに貼り付け]

あなたの役割は、この契約書を詳細に分析し、クライアントにとっての法的リスクと交渉ポイントを特定することです。特に以下の項目に注目してください：

1. 契約当事者と役割の明確性
2. 契約期間と更新条件の妥当性
3. 支払い条件と金額の適切性
4. 知的財産権の帰属と利用制限
5. 秘密保持義務の範囲と期間の適切性
6. 契約解除条件とその影響
7. 紛争解決方法の実効性

分析レポートは以下の形式で作成してください：
- 各項目について、該当する条項番号と内容を示す
- 各条項の法的リスクを「高」「中」「低」で評価し、その理由を説明する
- クライアントのために交渉すべきポイントと推奨される代替文言を提案する
- 契約書に不足している重要事項があれば指摘し、追加すべき条項を提案する

経験豊富な弁護士として、実務的で具体的なアドバイスを提供してください。
"""'''),
        
        # パターン2
        nbf.v4.new_markdown_cell("### パターン2：ステップバイステップ指示\n\n法的質問への回答タスクにステップバイステップ指示パターンを適用します。"),
        nbf.v4.new_code_cell('''"""
以下の法的質問に対して、段階的に分析し回答してください。

質問：[法的質問をここに記載]
例：「テレワーク中の従業員の労働時間管理について、企業が法的に遵守すべき事項は何ですか？」

ステップ1: 関連する法律と条文の特定
- この質問に関連する主要な法律と条文を列挙してください
- 各法律の目的と適用範囲を簡潔に説明してください

ステップ2: 法的要件の分析
- 特定した法律から導かれる具体的な法的要件を説明してください
- 要件ごとに遵守すべき事項を詳細に記述してください
- 要件間に優先関係や相互作用がある場合は、それも説明してください

ステップ3: 判例と行政解釈の調査
- 関連する重要な判例があれば、その要旨と意義を説明してください
- 行政機関（厚生労働省など）による解釈やガイドラインがあれば紹介してください
- 判例や解釈が実務に与える影響を分析してください

ステップ4: 実務上の対応策の提案
- 法的要件を満たすための具体的な対応策を提案してください
- 対応策ごとにメリットとデメリットを説明してください
- 企業規模や業種によって対応が異なる場合は、その違いも説明してください

ステップ5: 最新動向と今後の展望
- 最近の法改正や判例の変化があれば説明してください
- 今後予定されている法改正や社会的動向について触れてください
- 企業が将来的に備えるべき事項を提案してください

ステップ6: まとめと情報源
- 回答の要点を3-5つの箇条書きでまとめてください
- 参考にすべき公的情報源（官公庁サイトなど）を示してください
- この情報は一般的な法的情報提供であり、個別具体的な法的助言ではないことを明記してください

各ステップを順番に実行し、見出しを使って回答を構造化してください。
"""'''),
        
        # パターン3
        nbf.v4.new_markdown_cell("### パターン3：フューショット学習（例示）\n\n判例要約タスクにフューショット学習パターンを適用します。"),
        nbf.v4.new_code_cell('''"""
以下の判例を要約し、重要なポイントを抽出してください。私が期待する形式と内容レベルを示すために、まず別の判例の要約例を示します。

【要約例】
判例：最高裁判所平成10年9月10日判決（労働契約における安全配慮義務）

## 事案の概要
原告Xは被告Y社の従業員として長時間労働に従事した結果、うつ病を発症し休職した。Xは、Y社に対して安全配慮義務違反を理由とする損害賠償を請求した。第一審はX勝訴、控訴審はY勝訴となり、Xが上告した。

## 裁判所の判断
最高裁は上告を認容し、Y社の安全配慮義務違反を認定した。裁判所は「使用者は、労働契約に伴い、労働者の生命・身体・健康を危険から保護するよう配慮すべき義務（安全配慮義務）を負う」と判示し、Y社が長時間労働の実態を把握しながら対策を講じなかった点を義務違反と認定した。

## 重要な法的論点と解釈
本判決は、精神的健康も安全配慮義務の対象となることを明確にした点で重要である。また、使用者の義務として、①労働時間の適切な管理、②健康状態の把握、③過重労働の防止措置を具体的に示した。さらに、労働者の健康状態の悪化と業務との因果関係の立証基準についても言及している。

## 先例との関係
本判決は、従来の肉体的健康を中心とした安全配慮義務の概念を精神的健康にも拡大適用した点で、判例法理の発展を示している。最高裁昭和59年4月10日判決の安全配慮義務の基本的枠組みを踏襲しつつ、その適用範囲を明確に拡大した。

## 実務への影響と留意点
企業は従業員のメンタルヘルスにも配慮する法的義務があることが明確になった。実務上は、労働時間管理の徹底、定期的な健康診断の実施、ストレスチェック制度の活用、長時間労働者への医師面談の実施などが重要となる。また、労務管理体制の整備と記録保存の重要性も高まった。

## 実務上の教訓
- 労働時間の適正管理と記録保存が法的リスク管理として不可欠
- 従業員の精神的健康状態の定期的な把握と対応が必要
- 長時間労働の是正措置は経営者の法的責任
- 安全配慮義務違反は高額な損害賠償リスクを伴う
- 予防的な労務管理体制の構築が重要

【あなたが要約すべき判例】
[判例全文をここに貼り付け]

上記の例に倣って、この判例の要約と重要ポイントの抽出を行ってください。特に実務への影響と教訓を具体的に示すことが重要です。
"""'''),
        
        # 演習3
        nbf.v4.new_markdown_cell("## 演習3：プロンプトの反復的改善\n\nこの演習では、法的文書の要約プロンプトを段階的に改善していきます。"),
        
        # 初期プロンプト
        nbf.v4.new_markdown_cell("### 初期プロンプト"),
        nbf.v4.new_code_cell('''"""
この法律文書を要約してください。

[法律文書をここに貼り付け]
"""'''),
        
        # 改善プロンプト（最終段階）
        nbf.v4.new_markdown_cell("### 改善プロンプト（最終段階）"),
        nbf.v4.new_code_cell('''"""
あなたは法律文書を一般の人にも理解しやすく説明する専門家です。以下の法律文書を要約し、平易な言葉で説明してください。

[法律文書をここに貼り付け]

要約の要件：
1. 全体を500単語程度にまとめる
2. 文書の主要な目的と適用範囲を冒頭で明確に示す
3. 重要な法的権利と義務を箇条書きで列挙する
4. 専門用語には括弧内に簡単な説明を付ける
5. 重要な期限や条件を強調する
6. 一般の人が取るべき行動や注意点を含める

出力形式：
- 「概要」「主要な権利と義務」「重要な期限と条件」「一般の方への注意点」の4つのセクションに分ける
- 各セクションは見出しを付け、簡潔な段落で構成する
- 箇条書きを適切に使用して読みやすくする
- 平易な言葉を使用しつつ、法的正確性を維持する
"""'''),
        
        # 演習4
        nbf.v4.new_markdown_cell("## 演習4：実務向けプロンプトライブラリの作成\n\nこの演習では、法務業務で頻繁に使用できるプロンプトテンプレートを作成します。"),
        
        # テンプレート例
        nbf.v4.new_markdown_cell("### テンプレート例：契約書レビュー用プロンプト"),
        nbf.v4.new_code_cell('''"""
# 契約書レビュー・リスク分析プロンプト

## 目的
契約書の包括的なレビューを行い、法的リスクを特定し、改善提案を行う

## 入力情報
- 契約書全文
- 契約の種類：[例：販売契約、業務委託契約、雇用契約など]
- 自社の立場：[例：売主/買主、委託者/受託者など]
- 特に注意すべき事項：[例：知的財産権の保護、責任制限など]

## プロンプト本文
あなたは経験豊富な企業法務弁護士です。以下の契約書を詳細にレビューし、リスク分析と改善提案を行ってください。

契約種類：[契約の種類]
自社の立場：[自社の立場]
特に注意すべき事項：[特に注意すべき事項]

契約書：
[契約書全文]

以下の観点から分析してください：
1. 契約の基本構造と主要条項の概要
2. 各条項の法的リスク評価（高/中/低）とその理由
3. 自社に不利な条件や曖昧な表現
4. 業界標準と比較して異常または欠落している条項
5. 具体的な修正提案（代替文言の提示）

出力形式：
- 「概要」「リスク評価」「改善提案」「総合評価」のセクションに分けて回答
- リスク評価は条項ごとに表形式で示し、リスクレベル、理由、改善案を含める
- 特に重要な修正が必要な箇所は太字で強調
- 総合評価では、契約全体の受諾可能性を「このまま締結可」「修正後締結可」「大幅な修正が必要」「締結非推奨」のいずれかで示す
"""'''),
        
        # まとめ
        nbf.v4.new_markdown_cell("## まとめ\n\nこのノートブックでは、効果的なプロンプト設計のための4つの演習を通じて、様々なテクニックとパターンを学びました。これらの模範解答を参考に、実務でのプロンプト作成に活用してください。"),
    ]
    
    # Add cells to notebook
    nb['cells'] = cells
    
    # Write the notebook to a file
    notebook_path = '/home/ubuntu/repos/AI_Study/website/stage1/notebooks/exercises/prompt-engineering-answers.ipynb'
    with open(notebook_path, 'w', encoding='utf-8') as f:
        nbf.write(nb, f)
    
    print(f"Comprehensive prompt engineering notebook created at {notebook_path}")

# Execute the function
if __name__ == "__main__":
    create_prompt_engineering_notebook()
